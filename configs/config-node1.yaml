# Monitoring Configuration

# Email Settings
email:
  smtp_server: "smtp.qiye.aliyun.com"
  smtp_port: 465
  username: "service@legutech.com"
  password: "Wd2x9nPs4BEXdPdD"
  sender: "service@legutech.com"
  use_ssl: true
  use_tls: false
  receivers:
    - "yuqiyu@legutech.com"

# Global Alert Settings
alert_config:
  cooldown_seconds: 300       # Cooldown for same alert type
  aggregation_window: 60      # Wait time to collect alerts before sending (batching)

# Global Error Keywords (Regex supported)
error_keywords:
  - "OutOfMemoryError"
  - "Java heap space"
  - "连接失败或已断开连接"
  - "重连出错"
  - "批次消息处理达到限制"
  - "缓存消息堆积严重"
  - "线程池队列使用率超过 90%"

# Scheduled Reporting times
reporting:
  times:
    - "08:00"
    - "17:00"

# Services to Monitor
services:
  - name: "iot-data-receive-slave"
    docker_container_name: "iot-data-receive-slave"
    log_file_path: "/home/iot/iot-data-receive-slave/logs/error/latest.log"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    log_rules:
      error_threshold_count: 1
      error_threshold_window: 60
    
  - name: "iot-data-forward"
    docker_container_name: "iot-data-forward"
    log_file_path: "/home/iot/iot-data-forward/logs/error/latest.log"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    log_rules:
      error_threshold_count: 1
      error_threshold_window: 60

  - name: "iot-data-process"
    docker_container_name: "iot-data-process"
    log_file_path: "/home/iot/iot-data-process/logs/error/latest.log"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    log_rules:
      error_threshold_count: 1
      error_threshold_window: 60

  - name: "iot-data-rule-engine"
    docker_container_name: "iot-data-rule-engine"
    log_file_path: "/home/iot/iot-data-rule-engine/logs/error/latest.log"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    log_rules:
      error_threshold_count: 1
      error_threshold_window: 60

  - name: "notification-server"
    docker_container_name: "notification-server"
    log_file_path: "/home/notification/notification-server/logs/error/latest.log"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    log_rules:
      error_threshold_count: 1
      error_threshold_window: 60

  - name: "redis"
    docker_container_name: "redis"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    health_check:
      type: "tcp"
      host: "localhost"
      port: 6379

  - name: "rabbitmq"
    docker_container_name: "rabbitmq"
    metrics:
      memory_threshold: 80
      cpu_threshold: 90
    health_check:
      type: "tcp"
      host: "localhost"
      port: 5672