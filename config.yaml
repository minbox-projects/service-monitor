# Monitoring Configuration

# Logging Settings
logging:
  enabled: true
  file_path: "./logs/monitor.log"
  max_bytes: 10485760  # 10MB
  backup_count: 5      # Keep 5 backup files

# Email Settings
email:
  smtp_server: "smtp.qiye.aliyun.com"
  smtp_port: 465
  username: "service@xx.com"
  password: "xxxx"
  sender: "service@xxx.com"
  use_ssl: true
  use_tls: false
  receivers:
    - "xxx@xxxx.com"

# Global Alert Settings
alert_config:
  cooldown_seconds: 300       # Cooldown for same alert type
  aggregation_window: 60      # Wait time to collect alerts before sending (batching)

# Global Error Keywords (Regex supported)
# These apply if a service doesn't have specific log rules
error_keywords:
  - "OutOfMemoryError"
  - "Java heap space"
  - "GC overhead limit exceeded"
  - "Metaspace"
  - "unable to create new native thread"
  - "连接失败或已断开连接"

# Global Restart Keywords (for services with auto_restart enabled)
# These will be merged with any service-specific restart keywords
global_restart_keywords:
  - "OutOfMemoryError"
  - "Java heap space"
  - "GC overhead limit exceeded"
  - "Metaspace"
  - "unable to create new native thread"

# Scheduled Reporting times
reporting:
  times:
    - "08:00"
    - "18:00"

# Services to Monitor
services:
  - name: "notification-server"
    docker_container_name: "notification-server"
    health_check:
      interval: 10
    # Feature 2: Performance Metrics
    metrics:
      memory_threshold: 80  # %
      cpu_threshold: 90     # %
    # Feature 3: Enhanced Log Analysis
    log_file_path: "/home/notification/notification-server/logs/error/latest.log"
    log_rules:
      error_threshold_count: 10   # Alert if > 10 errors matched
      error_threshold_window: 60  # ... in 60 seconds
      # Auto-Restart Config
      auto_restart: true          # Automatically restart docker container on error threshold
      restart_keywords:
        - "OutOfMemoryError"
        - "Java heap space"
      restart_cooldown: 300       # Wait at least 5 mins between restarts

  - name: "api-server"
    # Feature 1: Health Check
    health_check:
      type: "http"
      url: "http://localhost:8080/health"
      timeout: 5
      interval: 30

  - name: "redis"
    docker_container_name: "redis"
    health_check:
      type: "tcp"
      host: "localhost"
      port: 6379
      timeout: 3
      interval: 30

    - name: "rabbitmq"
      docker_container_name: "rabbitmq"

  # System Resources Monitoring
  system_resources:
    enabled: true
    check_interval: 60
    disk:
      path: "/"
      alert_threshold: 90 # %
    memory:
      alert_threshold: 90 # %
    cpu:
      alert_threshold: 90 # %
      duration_seconds: 300 # Alert if high for 5 mins
    network:
      interface: "eth0"